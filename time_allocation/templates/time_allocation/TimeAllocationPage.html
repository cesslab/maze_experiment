{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}
{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'time_allocation/allocation.css' %}">
{% endblock %}

{% block content %}
    <div class="grid-container">
        <div>
            {% include 'preference/lottery_template.html' with op="V" high=l.high_prize low=l.low_prize rate=l.completion_rate p_high=l.prob_high_completed p_low=l.prob_low_incomplete %}
        </div>
        <div>
            {% include 'preference/lottery_template.html' with op="W" high=r.high_prize low=r.low_prize rate=r.completion_rate p_high=r.prob_high_completed p_low=r.prob_low_incomplete %}
        </div>
        <div>
            <input
                    type="number"
                    id="left_lottery_time"
                    name="left_lottery_time"
                    class="center-input form-control"
                    value="{{ form.left_lottery_time.value|default_if_none:"" }}"
                    placeholder="Enter Time for V" required>
            {# <small id="help" class="form-text text-muted">Your the time you would like to spend on V</small> #}

            {% if form.left_lottery_time.errors %}
                <div class="alert alert-danger">
                    {{ form.left_lottery_time.errors }}
                </div>
            {% endif %}
        </div>

        <div>
            <input
                    type="number"
                    id="right_lottery_time"
                    name="right_lottery_time"
                    placeholder="Enter Time for W" required
                    class="center-input form-control"
            >
        </div>
    </div>

    {% next_button %}
{% endblock %}

{% block scripts %}
    <script>
        const max = {{ max_time_seconds|json }};

        function updateInputPair(source, other) {
            if (!source.value) {
                other.value = "";
                return;
            }

            other.value = max - parseInt(source.value);
        }

        function timeAllocationHandler(event) {
            let source = event.target;
            let other = (source.id === "left_lottery_time") ? document.getElementById("right_lottery_time") : document.getElementById("left_lottery_time");
            updateInputPair(source, other)
        }

        document.getElementById("left_lottery_time").addEventListener('keyup', timeAllocationHandler);
        document.getElementById("right_lottery_time").addEventListener('keyup', timeAllocationHandler);
    </script>
{% endblock %}
